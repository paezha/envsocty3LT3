# Code to prepare data for Exercise-2

```{r load-packages}
library(readxl)
library(sf)
library(tidyverse)
library(units)
```

the file to an object, use the assignment `<-` and give the object a name; in this case `taz`, short for "traffic analyisis zones":
```{r}
hamilton_taz <- st_read("Hamilton-CMA-tts06.shp")
```

Project object:
```{r}
hamilton_taz <- hamilton_taz %>%
  st_transform(crs = 32617)
```

Prepare traffic analysis zones:
```{r}
hamilton_taz <- hamilton_taz %>%
  transmute(ID,
            AREA = st_area(geometry) %>% set_units(km^2) %>% drop_units(),
            GTA06 = as.character(GTA06))
```

Read travel data:
```{r}
hamilton_trips_purpose <- read_excel("Hamilton-CMA-Trips-by-Purpose.xlsx")
```

Rename variables:
```{r}
hamilton_trips_purpose <- hamilton_trips_purpose %>%
  rename(Worked_in_2010_Full_time = `Worked_in_2010_Full-time`,
         Worked_in_2010_Part_time = `Worked_in_2010_Part-time`)
```

Extract demographic information:
```{r}
hamilton_demo_taz <- hamilton_trips_purpose %>%
  transmute(GTA06,
            Population,
            Worked_in_2010_Full_time,
            Worked_in_2010_Part_time,
            Worked_at_home,
            Pop_Density,
            Median_Age,
            Family_Size_2,
            Family_Size_3,
            Family_Size_4,
            Family_Size_5_more,
            Median_income,
            Average_income,
            Employment_rate,
            Unemployment_rate,
            Median_commuting_duration)
```

Prepare table:
```{r}
hamilton_trips_purpose <- hamilton_trips_purpose %>%
  select(GTA06,
         Unknown,
         School,
         Subsequent_School,
         Work,
         Subsequent_Work,
         Daycare,
         Facilitate_passenger,
         Market_Shop,
         Home,
         Other)
```

Read data with trips by mode:
```{r}
hamilton_trips_mode <- read_excel("Hamilton-CMA-Trips-by-Mode.xlsx")
```

Prepare table for saving:
```{r}
hamilton_trips_mode <- hamilton_trips_mode %>%
  select(GTA06,
         Cycle,
         Auto_driver,
         Auto_passenger,
         Walk)
```

Save tables to folder `data`:
```{r save-processed-data}
usethis::use_data(hamilton_taz, overwrite = TRUE)
usethis::use_data(hamilton_trips_purpose, overwrite = TRUE)
usethis::use_data(hamilton_trips_mode, overwrite = TRUE)
usethis::use_data(hamilton_demo_taz, overwrite = TRUE)
```


